<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¾·å·æ‰‘å…‹Â·ç®€æ˜“å¯¹å±€ç»ˆç«¯</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }
        body {
            background: linear-gradient(145deg, #1a4d2a 0%, #0f3b1a 100%);
            margin: 0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .poker-table {
            max-width: 1100px;
            width: 100%;
            background: #2e7d5e;
            background-image: radial-gradient(circle at 30% 40%, #3b9e7a, #1e5a45);
            border-radius: 200px 200px 140px 140px;
            box-shadow: 0 30px 30px rgba(0,0,0,0.6), inset 0 -5px 0 rgba(0,0,0,0.3), inset 0 5px 15px rgba(255,255,200,0.2);
            padding: 40px 30px;
            border: 8px solid #b68b5c;
            position: relative;
        }
        .felt {
            background: #0a3f2b;
            background-image: repeating-linear-gradient(45deg, rgba(0,0,0,0.05) 0px, rgba(0,0,0,0.05) 2px, transparent 2px, transparent 10px);
            border-radius: 180px 180px 120px 120px;
            padding: 30px 25px;
            border: 2px solid #dbb42c;
            box-shadow: inset 0 0 30px rgba(0,0,0,0.7);
        }

        /* å…¬å…±ç‰ŒåŒº */
        .board-cards {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }
        .card-slot {
            width: 80px;
            height: 110px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            border: 2px solid #f5e7c8;
            box-shadow: 0 8px 0 #5f3f1a;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 28px;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 0 black;
        }
        .card {
            width: 80px;
            height: 110px;
            background: white;
            border-radius: 10px;
            border: 1px solid #ccc;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 10px 6px;
            box-shadow: 0 8px 0 #6b4a2c, 0 2px 5px rgba(0,0,0,0.5);
            font-weight: 700;
            position: relative;
        }
        .card.red {
            color: #c41e3a;
        }
        .card.black {
            color: #111;
        }
        .card .top-left {
            align-self: flex-start;
            font-size: 22px;
            line-height: 1;
        }
        .card .bottom-right {
            align-self: flex-end;
            font-size: 22px;
            transform: rotate(180deg);
            line-height: 1;
        }
        .card .suit-big {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 40px;
            opacity: 0.25;
        }

        /* ç©å®¶åŒºåŸŸ */
        .players-row {
            display: flex;
            justify-content: space-around;
            align-items: flex-end;
            gap: 20px;
            flex-wrap: wrap;
        }
        .player-spot {
            background: #0f2e22;
            border-radius: 30px 30px 20px 20px;
            padding: 20px 15px 15px;
            box-shadow: inset 0 -5px 0 #0a1f17, 0 10px 15px black;
            flex: 1 1 260px;
            border: 2px solid #d4af37;
            color: #ffefc0;
        }
        .player-spot.active-turn {
            border: 4px solid #ffd966;
            box-shadow: 0 0 20px #ffbf00;
            background: #1a4735;
        }
        .hole-cards {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 15px 0 10px;
        }
        .hole-card {
            width: 60px;
            height: 85px;
            background: white;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 26px;
            box-shadow: 0 5px 0 #2b1e0e;
        }
        .hole-card.back {
            background: #2a4a6e;
            color: white;
            font-size: 20px;
        }
        .chips-info {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 16px;
            background: #0a191f;
            padding: 8px 12px;
            border-radius: 40px;
            border: 1px solid #9f8c5c;
        }

        /* å†³ç­–é¢æ¿ */
        .action-panel {
            margin-top: 35px;
            background: #1d3b2b;
            border-radius: 60px;
            padding: 25px 25px;
            border: 2px solid #e6c873;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
            gap: 20px;
            box-shadow: inset 0 2px 5px #b9b06e, 0 5px 0 #4a3721;
        }
        .action-btn {
            background: #f5e7a7;
            border: none;
            border-radius: 40px;
            padding: 14px 28px;
            font-size: 22px;
            font-weight: bold;
            color: #1e3a1e;
            border-bottom: 6px solid #aa8c54;
            cursor: pointer;
            transition: 0.07s;
            display: flex;
            gap: 8px;
            align-items: center;
            box-shadow: 0 3px 5px black;
        }
        .action-btn:active {
            border-bottom-width: 2px;
            transform: translateY(4px);
            background: #ffe68f;
        }
        .action-btn:disabled {
            opacity: 0.4;
            border-bottom-width: 6px;
            transform: none;
            pointer-events: none;
        }
        .raise-input {
            width: 90px;
            padding: 14px 8px;
            font-size: 22px;
            border-radius: 30px;
            border: none;
            text-align: center;
            font-weight: bold;
            background: #efe3c9;
            border-bottom: 6px solid #8b7a54;
        }
        .pot-area {
            background: #1f2e1b;
            padding: 12px 25px;
            border-radius: 50px;
            color: #ffddaa;
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            border: 2px solid #facf5a;
            display: inline-block;
            margin-bottom: 20px;
        }

        .log-area {
            background: #0a1f1a;
            color: #b5e5b0;
            padding: 12px;
            margin-top: 25px;
            border-radius: 20px;
            font-family: monospace;
            font-size: 14px;
            max-height: 140px;
            overflow-y: auto;
            border: 1px solid #5f7a60;
        }

        .status-badge {
            background: #3c280e;
            padding: 6px 16px;
            border-radius: 40px;
            color: #ffd98c;
            font-weight: 500;
        }

        .debug-tools {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .debug-tools button {
            background: #3f6e4a;
            color: white;
            border-radius: 30px;
            padding: 8px 16px;
            border: none;
            cursor: pointer;
        }
        .debug-tools button:hover {
            background: #4f8e5a;
        }
    </style>
</head>
<body>
<div class="poker-table">
    <div class="felt">
        <!-- å…¬å…±ç‰Œå±•ç¤ºåŒº -->
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
            <span class="status-badge" id="gameStateLabel">PRE_FLOP</span>
            <div class="pot-area" id="potDisplay">åº•æ± : 0</div>
        </div>
        <div class="board-cards" id="communityCardsContainer">
            <!-- åŠ¨æ€ç”Ÿæˆ5ä¸ªå…¬å…±ç‰Œä½ç½® -->
            <div class="card-slot">?</div>
            <div class="card-slot">?</div>
            <div class="card-slot">?</div>
            <div class="card-slot">?</div>
            <div class="card-slot">?</div>
        </div>

        <!-- ç©å®¶åŒºåŸŸ (å›ºå®š2äºº) -->
        <div class="players-row" id="playersArea">
            <!-- ç©å®¶0 -->
            <div class="player-spot" id="player0Spot">
                <div style="font-size:20px; display:flex; justify-content:space-between;">
                    <span id="player0Name">ç­‰å¾…ç©å®¶...</span>
                    <span id="player0Status">â³</span>
                </div>
                <div class="hole-cards" id="player0Hole">
                    <div class="hole-card back">??</div>
                    <div class="hole-card back">??</div>
                </div>
                <div class="chips-info">
                    <span>ğŸ’° <span id="player0Chips">0</span></span>
                    <span>æŠ•å…¥ <span id="player0Invested">0</span></span>
                </div>
            </div>
            <!-- ç©å®¶1 (æˆ‘æ–¹) -->
            <div class="player-spot" id="player1Spot">
                <div style="font-size:20px; display:flex; justify-content:space-between;">
                    <span id="player1Name">ç­‰å¾…ç©å®¶...</span>
                    <span id="player1Status">â³</span>
                </div>
                <div class="hole-cards" id="player1Hole">
                    <div class="hole-card back" id="myCard1">??</div>
                    <div class="hole-card back" id="myCard2">??</div>
                </div>
                <div class="chips-info">
                    <span>ğŸ’° <span id="player1Chips">0</span></span>
                    <span>æŠ•å…¥ <span id="player1Invested">0</span></span>
                </div>
            </div>
        </div>

        <!-- è¡ŒåŠ¨å†³ç­–åŒº -->
        <div class="action-panel" id="actionPanel">
            <button class="action-btn" id="callBtn" disabled>CALL</button>
            <div style="display: flex; align-items: center; gap: 8px;">
                <button class="action-btn" id="raiseBtn" disabled>RAISE</button>
                <input type="number" id="raiseAmount" class="raise-input" value="2" min="1" max="100" step="1" disabled>
            </div>
            <button class="action-btn" id="foldBtn" disabled>FOLD</button>
            <div style="color:#ffdbb5; margin-left: 10px; font-size: 18px;" id="decisionHint">ç­‰å¾…æ¸¸æˆå¼€å§‹...</div>
        </div>

        <!-- æ¶ˆæ¯æ—¥å¿— -->
        <div class="log-area" id="logPanel">
            [ç³»ç»Ÿ] ç­‰å¾…è¿æ¥...
        </div>
    </div>
</div>

<script>

    let socket = null;
    const token = '[[${jwtToken}]]';

    // ============ çŠ¶æ€ç®¡ç† ============
    const state = {
        // æˆ‘çš„ç©å®¶IDï¼ˆä»æœåŠ¡å™¨è·å–ï¼‰
        myPlayerId: null,
        // æˆ‘çš„ç´¢å¼•ä½ç½®ï¼ˆåœ¨playerPublicVOä¸­çš„ç´¢å¼•ï¼‰
        myIndex: -1,
        // å½“å‰éœ€è¦å†³ç­–çš„ç©å®¶åºå·
        currentDecisionMakerId: -1,
        // æ¸¸æˆçŠ¶æ€
        gameState: 'INIT',
        // å…¬å…±ç‰Œ
        publicCards: [null, null, null, null, null],
        // åº•æ± 
        pot: 0,
        // ç©å®¶åˆ—è¡¨
        players: [
            { playerId: null, chipsInHand: 0, chipsInvested: 0, isContinuingGame: false },
            { playerId: null, chipsInHand: 0, chipsInvested: 0, isContinuingGame: false }
        ],
        // æˆ‘çš„æ‰‹ç‰Œ
        myHoleCards: [null, null]
    };

    // ============ è¾…åŠ©å‡½æ•° ============
    function suitSymbol(suit) {
        switch (suit) {
            case 'hearts': return 'â™¥';
            case 'diamonds': return 'â™¦';
            case 'clubs': return 'â™£';
            case 'spades': return 'â™ ';
            default: return '?';
        }
    }

    function cardColor(suit) {
        return (suit === 'hearts' || suit === 'diamonds') ? 'red' : 'black';
    }

    // æå–ç©å®¶åçš„ç®€å†™ï¼ˆå»æ‰æ—¶é—´æˆ³ï¼‰
    function getPlayerShortName(fullId) {
        if (!fullId) return 'ç­‰å¾…ç©å®¶...';
        return fullId.split(' ')[0];
    }

    // ============ UI æ¸²æŸ“ ============
    function renderAll() {
        renderCommunityCards();
        renderPlayers();
        renderMisc();
        highlightDecisionMaker();
    }

    // æ¸²æŸ“å…¬å…±ç‰Œ
    function renderCommunityCards() {
        const container = document.getElementById('communityCardsContainer');
        container.innerHTML = '';

        for (let i = 0; i < 5; i++) {
            const cardData = state.publicCards && state.publicCards[i];

            if (cardData && cardData.rank && cardData.suit) {
                const cardDiv = document.createElement('div');
                cardDiv.className = `card ${cardColor(cardData.suit)}`;
                const suitSym = suitSymbol(cardData.suit);
                cardDiv.innerHTML = `
                    <div class="top-left">${cardData.rank}${suitSym}</div>
                    <div class="suit-big">${suitSym}</div>
                    <div class="bottom-right">${cardData.rank}${suitSym}</div>
                `;
                container.appendChild(cardDiv);
            } else {
                const emptySlot = document.createElement('div');
                emptySlot.className = 'card-slot';
                emptySlot.textContent = '?';
                container.appendChild(emptySlot);
            }
        }
    }

    // æ¸²æŸ“ç©å®¶ä¿¡æ¯
    function renderPlayers() {
        // ç©å®¶0 (å¯¹æ‰‹)
        const p0 = state.players[0] || {};
        document.getElementById('player0Name').innerText = getPlayerShortName(p0.playerId);
        document.getElementById('player0Chips').innerText = p0.chipsInHand ?? 0;
        document.getElementById('player0Invested').innerText = p0.chipsInvested ?? 0;
        document.getElementById('player0Status').innerHTML = p0.isContinuingGame ? 'âœ“ æ¸¸æˆä¸­' : 'âœ— å‡ºå±€';

        // å¯¹æ‰‹æ‰‹ç‰Œå§‹ç»ˆæ˜¾ç¤ºèƒŒé¢
        const p0HoleDiv = document.getElementById('player0Hole');
        p0HoleDiv.innerHTML = `
            <div class="hole-card back">??</div>
            <div class="hole-card back">??</div>
        `;

        // ç©å®¶1
        const p1 = state.players[1] || {};
        document.getElementById('player1Name').innerText = getPlayerShortName(p1.playerId);
        document.getElementById('player1Chips').innerText = p1.chipsInHand ?? 0;
        document.getElementById('player1Invested').innerText = p1.chipsInvested ?? 0;
        document.getElementById('player1Status').innerHTML = p1.isContinuingGame ? 'âœ“ æ¸¸æˆä¸­' : 'âœ— å‡ºå±€';

        // æˆ‘æ–¹æ‰‹ç‰Œ
        const card1Div = document.getElementById('myCard1');
        const card2Div = document.getElementById('myCard2');

        if (state.myHoleCards && state.myHoleCards[0]) {
            const c1 = state.myHoleCards[0];
            card1Div.className = `hole-card ${cardColor(c1.suit)}`;
            card1Div.innerHTML = `${c1.rank}${suitSymbol(c1.suit)}`;
        } else {
            card1Div.className = 'hole-card back';
            card1Div.innerHTML = '??';
        }

        if (state.myHoleCards && state.myHoleCards[1]) {
            const c2 = state.myHoleCards[1];
            card2Div.className = `hole-card ${cardColor(c2.suit)}`;
            card2Div.innerHTML = `${c2.rank}${suitSymbol(c2.suit)}`;
        } else {
            card2Div.className = 'hole-card back';
            card2Div.innerHTML = '??';
        }
    }

    // æ¸²æŸ“åº•æ± å’Œæ¸¸æˆçŠ¶æ€
    function renderMisc() {
        document.getElementById('gameStateLabel').innerText = state.gameState || 'â€”';
        document.getElementById('potDisplay').innerHTML = `åº•æ± : ${state.pot}`;
    }

    // é«˜äº®å½“å‰å†³ç­–ç©å®¶å¹¶æ§åˆ¶æŒ‰é’®
    function highlightDecisionMaker() {
        const spot0 = document.getElementById('player0Spot');
        const spot1 = document.getElementById('player1Spot');
        const hintEl = document.getElementById('decisionHint');

        spot0.classList.remove('active-turn');
        spot1.classList.remove('active-turn');

        // åˆ¤æ–­è½®åˆ°è°
        addLog("My pos: " + state.myPlayerId);
        addLog("It's one's turn: " + state.currentDecisionMakerId);

        const isMyTurn = (state.currentDecisionMakerId !== -1 &&
            state.myPlayerId &&
            state.currentDecisionMakerId.toString() === state.myPlayerId.toString());

        addLog("My turn: " + isMyTurn);

        if (isMyTurn) {
            spot1.classList.add('active-turn');
            hintEl.innerText = 'ğŸ‘‰ è½®åˆ°ä½ è¡ŒåŠ¨';
        } else if (state.currentDecisionMakerId !== -1) {
            spot0.classList.add('active-turn');
            hintEl.innerText = 'å¯¹æ‰‹æ€è€ƒä¸­...';
        } else {
            hintEl.innerText = 'ç­‰å¾…æ¸¸æˆå¼€å§‹...';
        }

        // æ§åˆ¶æŒ‰é’®å¯ç”¨çŠ¶æ€ï¼šå¿…é¡»è½®åˆ°æˆ‘çš„å›åˆä¸”æˆ‘ä»åœ¨æ¸¸æˆä¸­
        const shouldEnable = isMyTurn &&
            state.players[state.myPlayerId - 1] &&
            state.players[state.myPlayerId - 1].isContinuingGame === true;

        enableActionButtons(shouldEnable);
    }

    // å¯ç”¨/ç¦ç”¨æ“ä½œæŒ‰é’®
    function enableActionButtons(enable) {
        const callBtn = document.getElementById('callBtn');
        const raiseBtn = document.getElementById('raiseBtn');
        const foldBtn = document.getElementById('foldBtn');
        const raiseInput = document.getElementById('raiseAmount');

        callBtn.disabled = !enable;
        raiseBtn.disabled = !enable;
        foldBtn.disabled = !enable;
        raiseInput.disabled = !enable;
    }

    // æ·»åŠ æ—¥å¿—
    function addLog(message) {
        const logDiv = document.getElementById('logPanel');
        const p = document.createElement('div');
        p.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
        logDiv.appendChild(p);
        logDiv.scrollTop = logDiv.scrollHeight;

        // é™åˆ¶æ—¥å¿—æ¡æ•°
        if (logDiv.children.length > 20) {
            logDiv.removeChild(logDiv.children[0]);
        }
    }

    // ============ æ¶ˆæ¯å¤„ç† ============
    function onServerMessage(jsonStr) {
        try {
            const msg = JSON.parse(jsonStr);
            addLog('ğŸ“© æ”¶åˆ°: ' + jsonStr.substring(0, 60) + (jsonStr.length > 60 ? '...' : ''));

            // å¤„ç†ç©å®¶ä½ç½®ä¿¡æ¯
            if (msg.dataType === 'PLAYER_POS') {
                state.myIndex = msg.data;
                state.myPlayerId = msg.data;
                addLog(`â„¹ï¸ æˆ‘çš„ä½ç½®ç´¢å¼•: ${state.myIndex}`);
            }

            // å¤„ç†ç§æœ‰æ‰‹ç‰Œ
            else if (msg.dataType === 'PRIVATE_VO' && msg.data && msg.data.holeCards) {
                state.myHoleCards = msg.data.holeCards;
                addLog(`ğŸ”’ æˆ‘çš„æ‰‹ç‰Œ: ${state.myHoleCards.map(c => c.rank + suitSymbol(c.suit)).join(' ')}`);
                renderPlayers();
            }

            // å¤„ç†å…¬å…±çŠ¶æ€
            else if (msg.dataType === 'PUBLIC_VO' && msg.data) {
                const publicVo = msg.data;
                const tablePublic = publicVo.tablePublicVO || {};
                const playerPublicList = publicVo.playerPublicVO || [];
                const potPublic = publicVo.potPublicVO || {};

                // æ›´æ–°æ¸¸æˆçŠ¶æ€
                state.gameState = tablePublic.currentGameState || state.gameState;
                state.currentDecisionMakerId = tablePublic.currentDecisionMakerId ?? -1;
                state.publicCards = tablePublic.publicCards || state.publicCards;
                state.pot = potPublic.allInvestedChips ?? 0;

                // æ›´æ–°ç©å®¶æ•°æ®
                if (playerPublicList.length >= 2) {
                    state.players = playerPublicList.map(p => ({
                        playerId: p.playerPersonalVO?.info?.playerId || null,
                        chipsInHand: p.chipsInHand ?? 0,
                        chipsInvested: p.chipsInvested ?? 0,
                        isContinuingGame: p.isContinuingGame ?? false,
                    }));

                    // å¦‚æœè¿˜ä¸çŸ¥é“æˆ‘çš„ç©å®¶IDï¼Œä»ç©å®¶æ•°æ®ä¸­æ ¹æ®ç´¢å¼•è·å–
                    if (!state.myPlayerId && state.myIndex !== -1 && state.players[state.myIndex]) {
                        state.myPlayerId = state.players[state.myIndex].playerId;
                        addLog(`â„¹ï¸ æˆ‘çš„ç©å®¶ID: ${state.myPlayerId}`);
                    }
                }

                // é‡æ–°æ¸²æŸ“æ‰€æœ‰UI
                renderAll();
            }

        } catch (e) {
            addLog('âŒ è§£ææ¶ˆæ¯å¤±è´¥: ' + e.message);
        }
    }

    // ============ å‘é€å†³ç­– ============
    function sendDecision(decision, amount = '0') {
        if (!socket || socket.readyState !== WebSocket.OPEN) {
            addLog('âŒ WebSocketæœªè¿æ¥');
            return;
        }

        const decisionMsg = {
            dataType: 'PLAYER_DECISION',
            data: {
                decision: decision,
                amount: amount.toString()
            }
        };

        const jsonStr = JSON.stringify(decisionMsg);
        addLog(`ğŸ”¼ å‘é€: ${jsonStr}`);
        socket.send(jsonStr);

        // å‘é€åç«‹å³ç¦ç”¨æŒ‰é’®ï¼Œé¿å…é‡å¤ç‚¹å‡»
        enableActionButtons(false);
    }

    // ============ äº‹ä»¶ç»‘å®š ============
    function bindActions() {
        document.getElementById('callBtn').addEventListener('click', () => {
            sendDecision('CALL', '0');
        });

        document.getElementById('raiseBtn').addEventListener('click', () => {
            const amount = document.getElementById('raiseAmount').value;
            sendDecision('RAISE', amount);
        });

        document.getElementById('foldBtn').addEventListener('click', () => {
            sendDecision('FOLD', '0');
        });
    }

    // ============ WebSocket è¿æ¥ ============
    function connect() {
        if (socket && socket.readyState === WebSocket.OPEN) {
            addLog('â„¹ï¸ å·²ç»è¿æ¥');
            return;
        }

        try {
            socket = new WebSocket('ws://localhost:8080/ws');

            socket.onopen = function() {
                addLog('âœ… WebSocketå·²è¿æ¥');
                socket.send(token);
                addLog('ğŸ“¤ å‘é€è®¤è¯ä»¤ç‰Œ');
            };

            socket.onmessage = function(event) {
                onServerMessage(event.data);
            };

            socket.onclose = function(event) {
                addLog(`ğŸ”Œ WebSocketè¿æ¥å…³é—­ (ä»£ç : ${event.code})`);
                socket = null;
                enableActionButtons(false);
                document.getElementById('decisionHint').innerText = 'è¿æ¥å·²æ–­å¼€';
            };

            socket.onerror = function(error) {
                addLog('âŒ WebSocketé”™è¯¯');
                console.error('WebSocket error:', error);
            };

        } catch (e) {
            addLog('âŒ è¿æ¥å¤±è´¥: ' + e.message);
        }
    }

    function disconnect() {
        if (socket) {
            socket.close();
            socket = null;
        }
    }

    // ============ åˆå§‹åŒ– ============
    window.addEventListener('DOMContentLoaded', function() {
        bindActions();

        // é‡ç½®çŠ¶æ€
        state.myPlayerId = null;
        state.myIndex = -1;
        state.currentDecisionMakerId = -1;
        state.gameState = 'INIT';
        state.publicCards = [null, null, null, null, null];
        state.pot = 0;
        state.players = [
            { playerId: null, chipsInHand: 0, chipsInvested: 0, isContinuingGame: false },
            { playerId: null, chipsInHand: 0, chipsInvested: 0, isContinuingGame: false }
        ];
        state.myHoleCards = [null, null];

        // é‡æ–°æ¸²æŸ“
        renderAll();
        addLog('ç³»ç»Ÿ: ç­‰å¾…WebSocketè¿æ¥...');

        // è‡ªåŠ¨è¿æ¥
        connect();
    });

    // æ¸…ç†è¿æ¥ï¼ˆé¡µé¢å…³é—­æ—¶ï¼‰
    window.addEventListener('beforeunload', function() {
        disconnect();
    });

    // æš´éœ²ç»™è°ƒè¯•å·¥å…·
    window.connect = connect;
    window.disconnect = disconnect;
    window.onServerMessage = onServerMessage; // ä¿ç•™ç”¨äºè°ƒè¯•
</script>

</body>
</html>